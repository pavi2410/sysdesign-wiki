---
interface Props {
  prompt: string;
  systemName: string;
  label?: string;
}

const { prompt, systemName, label = 'Implement' } = Astro.props;
---

<div class="copy-prompt-wrapper my-10 p-6 bg-white border border-border rounded-xl">
  <div class="flex items-start gap-4">
    <div class="w-10 h-10 rounded-lg bg-accent/10 flex items-center justify-center shrink-0">
      <svg class="w-5 h-5 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
        <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
      </svg>
    </div>
    <div class="flex-1 min-w-0">
      <h3 class="font-serif text-lg font-bold text-ink mb-1">{label} {systemName}</h3>
      <p class="text-sm text-ink-muted mb-4">
        Copy a detailed architecture prompt to use with any AI coding assistant. It includes the full system design, data models, components, and tradeoffs â€” ready to kickstart your own implementation.
      </p>
      <div class="flex items-center gap-3">
        <button
          class="copy-prompt-btn inline-flex items-center gap-2 bg-accent text-white px-5 py-2.5 rounded-lg text-sm font-medium hover:bg-accent-hover transition-all active:scale-[0.98]"
          data-prompt={prompt}
        >
          <svg class="w-4 h-4 copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
          </svg>
          <svg class="w-4 h-4 check-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 6 9 17l-5-5"></path>
          </svg>
          <span class="btn-text">Copy as Prompt</span>
        </button>
        <button
          class="preview-prompt-btn inline-flex items-center gap-2 text-ink-light px-4 py-2.5 rounded-lg text-sm font-medium border border-border hover:border-accent/40 hover:text-accent transition-all"
          data-prompt={prompt}
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          Preview Prompt
        </button>
      </div>
    </div>
  </div>

  <!-- Prompt preview (hidden by default) -->
  <div class="prompt-preview hidden mt-6 border-t border-border pt-5">
    <div class="flex items-center justify-between mb-3">
      <p class="text-xs font-semibold uppercase tracking-widest text-ink-muted">Prompt Preview</p>
      <button class="close-preview text-xs text-ink-muted hover:text-accent transition-colors">Close</button>
    </div>
    <pre class="text-xs text-ink-light bg-paper-warm border border-border rounded-lg p-4 max-h-80 overflow-y-auto whitespace-pre-wrap font-mono leading-relaxed">{prompt.slice(0, 2000)}{'...\n\n[Full prompt copied to clipboard]'}</pre>
  </div>
</div>

<script>
  document.querySelectorAll('.copy-prompt-btn').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const prompt = btn.getAttribute('data-prompt');
      if (!prompt) return;

      try {
        await navigator.clipboard.writeText(prompt);
        const text = btn.querySelector('.btn-text') as HTMLElement;
        const copyIcon = btn.querySelector('.copy-icon') as HTMLElement;
        const checkIcon = btn.querySelector('.check-icon') as HTMLElement;

        text.textContent = 'Copied!';
        copyIcon.classList.add('hidden');
        checkIcon.classList.remove('hidden');

        setTimeout(() => {
          text.textContent = 'Copy as Prompt';
          copyIcon.classList.remove('hidden');
          checkIcon.classList.add('hidden');
        }, 2000);
      } catch {
        const textarea = document.createElement('textarea');
        textarea.value = prompt;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        const text = btn.querySelector('.btn-text') as HTMLElement;
        text.textContent = 'Copied!';
        setTimeout(() => { text.textContent = 'Copy as Prompt'; }, 2000);
      }
    });
  });

  document.querySelectorAll('.preview-prompt-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      const wrapper = btn.closest('.copy-prompt-wrapper');
      const preview = wrapper?.querySelector('.prompt-preview');
      if (preview) preview.classList.toggle('hidden');
    });
  });

  document.querySelectorAll('.close-preview').forEach((btn) => {
    btn.addEventListener('click', () => {
      const preview = btn.closest('.prompt-preview');
      if (preview) preview.classList.add('hidden');
    });
  });
</script>
